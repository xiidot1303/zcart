<?php
/*   __________________________________________________
    |  Obfuscated by YAK Pro - Php Obfuscator  2.0.14  |
    |              on 2023-10-02 21:22:31              |
    |    GitHub: https://github.com/pk-fr/yakpro-po    |
    |__________________________________________________|
*/
/*
* Copyright (C) Incevio Systems, Inc - All Rights Reserved
* Unauthorized copying of this file, via any medium is strictly prohibited
* Proprietary and confidential
* Written by Munna Khan <help.zcart@gmail.com>, September 2018
*/
 namespace App\Http\Controllers\Admin; use App\Common\Authorizable; use App\Http\Requests\Validations\ThemeInstallationRequest; use App\Models\SystemConfig; use Illuminate\Http\Request; use Illuminate\Support\Facades\App; use App\Http\Controllers\Controller; use Illuminate\Support\Facades\Log; use Illuminate\Support\Facades\Session; use App\Events\System\SystemConfigUpdated; class ThemeController extends Controller { use Authorizable; public function all() { $storeFrontThemes = collect($this->storeFrontThemes()); $t_theme = active_theme(); $active_theme = $storeFrontThemes->firstWhere("\x73\154\x75\147", $t_theme); $storeFrontThemes = $storeFrontThemes->filter(function ($value, $key) use($t_theme) { return $value["\x73\154\x75\x67"] != $t_theme; }); $sellingThemes = collect($this->sellingThemes()); return view("\141\144\155\151\156\56\x74\150\145\155\145\x2e\151\x6e\x64\145\x78", compact("\163\x74\157\x72\145\106\162\157\156\x74\124\150\145\x6d\145\x73", "\141\x63\164\151\166\145\x5f\164\150\x65\155\x65", "\x73\145\154\x6c\x69\x6e\x67\124\x68\x65\155\x65\163")); } public function initiate(Request $request, $theme) { if (!(config("\x61\160\x70\56\144\x65\x6d\157") == true && config("\x61\x70\160\x2e\144\x65\x62\165\147") !== true)) { goto bB_4l; } return back()->with("\x77\x61\162\x6e\x69\x6e\x67", trans("\x6d\145\x73\163\x61\147\145\163\x2e\x64\x65\155\x6f\x5f\162\145\163\x74\162\x69\143\164\151\x6f\x6e")); bB_4l: return view("\141\x64\155\151\156\x2e\x74\150\145\155\x65\x2e\137\x69\x6e\151\x74\x69\x61\164\145", compact("\164\150\145\155\145")); } public function activate(ThemeInstallationRequest $request, $theme, $type = "\163\x74\x6f\x72\145\146\x72\x6f\x6e\x74") { if (!(config("\x61\x70\160\x2e\144\145\x6d\x6f") == true)) { goto NW29l; } Session::put("\x74\150\x65\155\x65", $theme); return back()->with("\163\x75\x63\143\145\163\x73", trans("\x6d\145\163\x73\141\x67\145\x73\x2e\x74\x68\145\155\x65\137\x61\143\x74\x69\166\141\x74\145\x64", ["\164\x68\145\x6d\145" => $theme])); NW29l: $system = SystemConfig::orderBy("\x69\x64", "\x61\x73\x63")->first(); $this->authorize("\165\160\x64\x61\x74\x65", $system); Log::info("\x49\x6e\x73\x74\141\154\154\x69\x6e\x67\40\x74\150\x65\x6d\145\x20" . $theme); try { if ($type == "\163\x65\154\154\x69\x6e\x67") { goto iBkEU; } $installable = $this->storeFrontThemes($theme); $system->active_theme = $theme; goto pR_TM; iBkEU: $installable = $this->sellingThemes($theme); $system->selling_theme = $theme; pR_TM: preparePackageInstallation(array_merge($request->all(), $installable)); } catch (\Exception $exception) { Log::info("\x54\x68\x65\155\145\x20\x69\156\x73\x74\x61\x6c\x6c\141\164\x69\157\x6e\x20\x66\141\x69\x6c\x65\x64\40" . $theme); Log::error(get_exception_message($exception)); return back()->with("\x65\162\162\157\162", $exception->getMessage()); } if (!$system->save()) { goto voP3j; } event(new SystemConfigUpdated($system)); return back()->with("\163\165\x63\143\145\163\163", trans("\155\x65\163\163\x61\x67\145\163\56\x74\x68\145\155\145\x5f\141\143\164\x69\166\141\164\x65\x64", ["\x74\150\145\155\x65" => $theme])); voP3j: return back()->with("\145\x72\x72\x6f\x72", trans("\155\x65\x73\163\141\147\x65\x73\x2e\x66\x61\x69\x6c\x65\x64")); } private function storeFrontThemes($slug = null) { $storeFrontThemes = []; foreach (glob(theme_path("\x2a"), GLOB_ONLYDIR) as $themeFolder) { $themeFolder = realpath($themeFolder); if (!file_exists($jsonFilename = $themeFolder . "\57" . "\164\150\x65\x6d\x65\x2e\x6a\x73\x6f\156")) { goto pRpJC; } $folders = explode(DIRECTORY_SEPARATOR, $themeFolder); $themeName = end($folders); $data = []; $json = file_get_contents($jsonFilename); if (!($json !== '')) { goto jGglv; } $data = json_decode($json, true); if (!($data === null)) { goto OVcHc; } throw new \Exception("\x49\156\x76\x61\x6c\151\x64\x20\x74\150\x65\155\x65\56\x6a\163\x6f\x6e\40\x66\x69\x6c\145\40\141\x74\x20\133{$themeFolder}\135"); OVcHc: if (!(!$data["\162\x65\154\x65\141\x73\145\x64"] && App::environment(["\160\x72\157\x64\x75\143\x74\x69\x6f\x6e"]))) { goto erfGg; } goto tHq2N; erfGg: jGglv: if (!($slug && $data["\163\154\165\x67"] == $slug)) { goto FtCC9; } $data["\160\x61\x74\150"] = $themeFolder; return $data; FtCC9: $data["\x61\163\163\x65\x74\x73\55\x70\141\164\150"] = theme_assets_path($data["\163\x6c\x75\147"]); $data["\x76\x69\x65\x77\x73\55\x70\141\x74\x68"] = theme_views_path($data["\163\154\x75\147"]); $storeFrontThemes[] = $data; pRpJC: tHq2N: } aILX4: usort($storeFrontThemes, function ($x, $y) { return strnatcmp($x["\156\x61\x6d\x65"], $y["\x6e\141\x6d\145"]); }); return $storeFrontThemes; } private function sellingThemes($slug = null) { $sellingThemes = []; foreach (glob(selling_theme_path("\x2a"), GLOB_ONLYDIR) as $themeFolder) { $themeFolder = realpath($themeFolder); if (!file_exists($jsonFilename = $themeFolder . "\x2f" . "\x74\150\145\155\x65\56\152\163\157\x6e")) { goto L3Bol; } $folders = explode(DIRECTORY_SEPARATOR, $themeFolder); $themeName = end($folders); $data = []; $json = file_get_contents($jsonFilename); if (!($json !== '')) { goto PPk9y; } $data = json_decode($json, true); if (!($data === null)) { goto FPWxq; } throw new \Exception("\111\x6e\166\141\154\151\x64\x20\x74\x68\145\x6d\x65\x2e\152\163\157\156\40\x66\151\154\145\40\x61\x74\40\x5b{$themeFolder}\x5d"); FPWxq: PPk9y: if (!($slug && $data["\163\154\x75\x67"] == $slug)) { goto Ms9k8; } $data["\160\141\x74\x68"] = $themeFolder; return $data; Ms9k8: $data["\x61\163\x73\145\x74\x73\55\x70\141\164\150"] = selling_theme_assets_path($data["\x73\x6c\165\x67"]); $data["\166\151\145\x77\x73\x2d\160\x61\x74\x68"] = selling_theme_views_path($data["\163\x6c\165\x67"]); $sellingThemes[] = $data; L3Bol: rx89w: } J9XNo: usort($sellingThemes, function ($x, $y) { return strnatcmp($x["\x6e\x61\x6d\145"], $y["\x6e\x61\155\x65"]); }); return $sellingThemes; } }